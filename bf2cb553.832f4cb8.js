(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{142:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return r})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return d}));var i=n(2),a=n(6),o=(n(0),n(178)),s={id:"sdk-connectivity-destination-service",title:"Use destinations to connect to other systems and services",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destinations",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like S/4HANA or SAP Cloud Platform services.",keywords:["sap","cloud","sdk","destination","java","connectivity"]},r={unversionedId:"java/features/connectivity/sdk-connectivity-destination-service",id:"java/features/connectivity/sdk-connectivity-destination-service",isDocsHomePage:!1,title:"Use destinations to connect to other systems and services",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like S/4HANA or SAP Cloud Platform services.",source:"@site/docs/java/features/connectivity/destinations.mdx",slug:"/java/features/connectivity/sdk-connectivity-destination-service",permalink:"/cloud-sdk/docs/java/features/connectivity/sdk-connectivity-destination-service",editUrl:"https://github.com/SAP/cloud-sdk/edit/documentation/docs/java/features/connectivity/destinations.mdx",version:"current",lastUpdatedBy:"Alexander D\xfcmont",lastUpdatedAt:1600077427,sidebar_label:"Destinations",sidebar:"someSidebar",previous:{title:"Call a BAPI/RFC Module with SAP Cloud SDK for Java",permalink:"/cloud-sdk/docs/java/features/bapi-and-rfc/bapi-and-rfc-overview"},next:{title:"Use the HttpClient accessor to configure requests to remote services",permalink:"/cloud-sdk/docs/java/features/connectivity/sdk-connectivity-http-client"}},c=[{value:"Accessing Destinations",id:"accessing-destinations",children:[{value:"Integrated Multi-Tenancy",id:"integrated-multi-tenancy",children:[]}]},{value:"Decorating Destinations",id:"decorating-destinations",children:[{value:"HTTP Destinations",id:"http-destinations",children:[]},{value:"BAPI Destinations",id:"bapi-destinations",children:[]},{value:"Connect to on-premise S/4HANA system",id:"connect-to-on-premise-s4hana-system",children:[]}]},{value:"Testing destinations in local environment",id:"testing-destinations-in-local-environment",children:[]},{value:"Retrieving destinations",id:"retrieving-destinations",children:[{value:"Get all destinations from the Destination Service on Cloud Foundry",id:"get-all-destinations-from-the-destination-service-on-cloud-foundry",children:[]}]}],l={rightToc:c};function d(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(i.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The SAP Cloud SDK offers some basic functionality that helps with connecting to other systems and services like S/4HANA Cloud. The SDK introduces the general concept of a ",Object(o.b)("inlineCode",{parentName:"p"},"Destination")," which holds basic information about how to connect to such a system. That could for instance be a ",Object(o.b)("inlineCode",{parentName:"p"},"url"),", a user name, and password for basic authentication or some custom headers."),Object(o.b)("p",null,"This concept is integrated with the ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/7e306250e08340f89d6c103e28840f30.html"}),"Destination Service")," that is available on SAP Cloud Platform. If the application has a service binding to this service in place the SDK will provide access to these destinations."),Object(o.b)("h2",{id:"accessing-destinations"},"Accessing Destinations"),Object(o.b)("p",null,"In general destinations are accessed through the ",Object(o.b)("inlineCode",{parentName:"p"},"DestinationAccessor"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),'DestinationAccessor.getDestination("my-destination");\n')),Object(o.b)("p",null,"This will look up the destination in the destination service if the application is running on SAP Cloud Platform. But\nalso, other sources like the environment variables are considered."),Object(o.b)("h3",{id:"integrated-multi-tenancy"},"Integrated Multi-Tenancy"),Object(o.b)("p",null,"By default, the ",Object(o.b)("inlineCode",{parentName:"p"},"DestinationAccessor")," is tenant aware.\nIf a tenant is available it will be used to access the destination service on behalf of that tenant.\nIf no destination is found in the tenant-specific destination service the SDK will try to get it using the service binding of the application."),Object(o.b)("p",null,"This default retrieval strategy can be overridden by passing options to the destination loader as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),"DestinationAccessor.getLoader().tryGetDestination(destinationName, options);\n")),Object(o.b)("p",null,"See the section on ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"#building-destination-options"}),"destination options")," below."),Object(o.b)("h2",{id:"decorating-destinations"},"Decorating Destinations"),Object(o.b)("p",null,"Depending on the use case, one needs to wrap the accessed destination before issuing a request to a system. This is to make sure all required destination properties are correctly set before invoking the actual request."),Object(o.b)("h3",{id:"http-destinations"},"HTTP Destinations"),Object(o.b)("p",null,"In case of HTTP connections one needs to wrap the retrieved destination as ",Object(o.b)("inlineCode",{parentName:"p"},"HttpDestination")," using ",Object(o.b)("inlineCode",{parentName:"p"},"asHttp()"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),'DestinationAccessor.getDestination("my-destination").asHttp();\n')),Object(o.b)("p",null,"This method ensures that the required destination properties are all set to make the HTTP connection.\nWith the resulting destination instance depending on the use case one can run HTTP queries for ODATA or REST."),Object(o.b)("h3",{id:"bapi-destinations"},"BAPI Destinations"),Object(o.b)("p",null,"Similarly, for BAPI endpoints you need to use ",Object(o.b)("inlineCode",{parentName:"p"},"asRfc()"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),'DestinationAccessor.getDestination("my-destination").asRfc();\n')),Object(o.b)("h3",{id:"connect-to-on-premise-s4hana-system"},"Connect to on-premise S/4HANA system"),Object(o.b)("p",null,"If your destination is exposing an on-premise S/4HANA service via a ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(i.a)({parentName:"strong"},{href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/e6c7616abb5710148cfcf3e75d96d596.html"}),"Cloud\nConnector")),"\nyou need to decorate the destination with ",Object(o.b)("inlineCode",{parentName:"p"},"DefaultErpHttpDestination"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),"final HttpDestination httpDestination =\ndestination.asHttp().decorate(DefaultErpHttpDestination::new);\n")),Object(o.b)("p",null,"This ensures the mapping of all S/4 properties like ",Object(o.b)("inlineCode",{parentName:"p"},"sap-client")," and ",Object(o.b)("inlineCode",{parentName:"p"},"sap-locale")," as HTTP request headers."),Object(o.b)("h2",{id:"testing-destinations-in-local-environment"},"Testing destinations in local environment"),Object(o.b)("p",null,"For testing purposes, the SDK provides functionality to provide such a destination in a local development environment.\nThis is especially useful when working with destinations from the destination service since the service is not available in a local setting."),Object(o.b)("p",null,"The SDK offers a ",Object(o.b)("inlineCode",{parentName:"p"},"MockUtil")," class that is capable of injecting destinations into the ",Object(o.b)("inlineCode",{parentName:"p"},"DestinationAccessor"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),'final MockUtil mockUtil = new MockUtil();\n\nMockDestination destination = MockDestination\n            .builder("my-destination", URI.create("http://localhost:8080"))\n            .build();\n\nmockUtil.mockDestination(destination);\n\n// This will now return the mocked destination\nDestinationAccessor.getDestination("my-destination").asHttp();\n')),Object(o.b)("p",null,"This helps with keeping production and test code nicely separated.\nThere are more overloads of the mocking on the ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/testutil/MockUtil.html"}),"MockUtil class")," that you can use.\nAlso refer to ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://developers.sap.com/tutorials/s4sdk-odata-service-cloud-foundry.html#b77d53b0-2d8b-449c-9a9a-9df80ee09a4e"}),"these tutorial steps")," on how to mock destinations for local development and testing."),Object(o.b)("h2",{id:"retrieving-destinations"},"Retrieving destinations"),Object(o.b)("h3",{id:"get-all-destinations-from-the-destination-service-on-cloud-foundry"},"Get all destinations from the Destination Service on Cloud Foundry"),Object(o.b)("p",null,"To fetch all destinations from the Destination Service, you need to make a call to ",Object(o.b)("inlineCode",{parentName:"p"},"tryGetAllDestinations"),".The method queries the ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://api.sap.com/api/SAP_CP_CF_Connectivity_Destination/overview"}),"Destination Service API")," and retrieves all the destinations available at the service instance and sub-account level. In case there is a destination available on both the levels with the same name, then this method prioritizes the destination at the service instance level."),Object(o.b)("p",null,"Below is the sample call to ",Object(o.b)("inlineCode",{parentName:"p"},"tryGetAllDestinations"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),"final Try<Iterable<ScpCfDestination>> destinations = destinationLoader.tryGetAllDestinations(options);\n")),Object(o.b)("p",null,"In the above call ",Object(o.b)("inlineCode",{parentName:"p"},"destinationLoader")," needs to be an instance of ",Object(o.b)("inlineCode",{parentName:"p"},"ScpCfDestinationLoader"),"."),Object(o.b)("h4",{id:"building-destination-options"},"Building Destination Options"),Object(o.b)("p",null,"You need to build a ",Object(o.b)("inlineCode",{parentName:"p"},"DestinationOptions")," object and pass it as a parameter. It defines how Destinations Service is queried. In a simple application without provider/subscriber setup, your initial configuration is as simple as:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),"final DestinationOptions options = DestinationOptions.builder().build();\n")),Object(o.b)("p",null,"For a provider/subscriber setup, a ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/cloudplatform/connectivity/ScpCfDestinationRetrievalStrategy.html"}),"retrieval strategy")," must be chosen according to your particular use case from:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"ALWAYS_SUBSCRIBER")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"ALWAYS_PROVIDER")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"SUBSCRIBER_THEN_PROVIDER"),".")),Object(o.b)("p",null,"Here is an example for ",Object(o.b)("inlineCode",{parentName:"p"},"SUBSCRIBER_THEN_PROVIDER")," option:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-java"}),"final DestinationOptions options =\n          DestinationOptions\n              .builder()\n              .augmentBuilder(\n                  ScpCfDestinationOptionsAugmenter.augmenter().retrievalStrategy(\n                      ScpCfDestinationRetrievalStrategy.SUBSCRIBER_THEN_PROVIDER))\n              .build();\n")),Object(o.b)("p",null,"You can similarly use other retrieval options."))}d.isMDXComponent=!0},178:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var i=n(0),a=n.n(i);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),d=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=d(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},u=a.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=d(n),u=i,h=p["".concat(s,".").concat(u)]||p[u]||b[u]||o;return n?a.a.createElement(h,r(r({ref:t},l),{},{components:n})):a.a.createElement(h,r({ref:t},l))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,s=new Array(o);s[0]=u;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r.mdxType="string"==typeof e?e:i,s[1]=r;for(var l=2;l<o;l++)s[l]=n[l];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);